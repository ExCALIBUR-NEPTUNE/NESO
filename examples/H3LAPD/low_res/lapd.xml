<?xml version="1.0" encoding="utf-8" ?>
<NEKTAR>
    <COLLECTIONS DEFAULT="MatrixFree" />
    <!--
        The composite indices for the domain are expected to be 0 and 4 if the
        mesh was generated from the .geo files
     -->
    <EXPANSIONS>
       <E COMPOSITE="C[0]" NUMMODES="2" TYPE="MODIFIED" FIELDS="ne,Ge,Gd,w,phi" />
       <E COMPOSITE="C[4]" NUMMODES="2" TYPE="MODIFIED" FIELDS="ne,Ge,Gd,w,phi" />
    </EXPANSIONS>

    <CONDITIONS>
        <SOLVERINFO>
            <I PROPERTY="EQTYPE"                   VALUE="LAPD"                 />
            <I PROPERTY="AdvectionType"            VALUE="WeakDG"               />
            <I PROPERTY="GlobalSysSoln"            VALUE="IterativeStaticCond"  />
            <I PROPERTY="IterativeSolverTolerance" VALUE="1e-10"                />
            <I PROPERTY="Projection"               VALUE="DisContinuous"        />
            <I PROPERTY="TimeIntegrationMethod"    VALUE="ClassicalRungeKutta4" />
            <I PROPERTY="UpwindType"               VALUE="Upwind"               />
        </SOLVERINFO>

        <PARAMETERS>
            <P> TFinal         = 1               </P>
            <P> TimeStep       = 0.001           </P>
            <P> NumSteps       = TFinal/TimeStep </P>
            <P> IO_InfoSteps   = NumSteps+1      </P>
            <P> IO_CheckSteps  = NumSteps/50     </P>
            <P> Bxy            = 0.1             </P> <!-- Magnetic field strength in T -->
            <P> e              = 1.0             </P> <!-- Charge unit -->
            <P> md             = 2.0             </P> <!-- Ion mass -->
            <P> me             = 60./1836        </P> <!-- Electron mass - default val multiplied by 60 to improve convergence -->
            <P> Nnorm          = 1e18            </P> <!-- Density normalisation -->
            <P> nu_ei          = 1.0             </P> <!-- Electron-ion collision coefficient -->
            <P> Rmax           = 0.4             </P> <!-- Radius of cylindrical domain; used in ICs -->
            <P> Te             = 5.0             </P> <!-- Electron temperature -->
            <P> Td             = 0.1             </P> <!-- Ion temperature -->
            <P> cs             = 1.584           </P> <!-- Sound speed = sqrt(e*(T_d+T_e)/(m_d+m_e))-->
            <P> vNorm          = cs              </P> <!-- Velocity normalisation = sound speed -->
        </PARAMETERS>

        <VARIABLES>
            <V ID="0"> ne  </V>
            <V ID="1"> Ge  </V>
            <V ID="2"> Gd  </V>
            <V ID="3"> w   </V>
            <V ID="4"> phi </V>
        </VARIABLES>

        <BOUNDARYREGIONS>
            <B ID="0"> C[1] </B> <!-- Curved surface -->
            <B ID="1"> C[2] </B> <!-- Circular (low z) end -->
            <B ID="2"> C[3] </B> <!-- Circular (high z) end -->
        </BOUNDARYREGIONS>

        <BOUNDARYCONDITIONS>
            <REGION REF="0">
                <N VAR="ne" VALUE="0" />
                <!-- No slip conditions, parallel velocities/momenta go to zero -->
                <D VAR="Ge" VALUE="0" />
                <D VAR="Gd" VALUE="0" />
                <N VAR="w" VALUE="0" />
                <N VAR="phi" VALUE="0" />
            </REGION>
            <REGION REF="1">
                <!-- Sheath conditions - outflow at the sound speed -->
                <D VAR="ne" VALUE="Nnorm" />
                <D VAR="Ge" VALUE="-vNorm*Nnorm*me" />
                <D VAR="Gd" VALUE="-vNorm*Nnorm*md" />
                <N VAR="w" VALUE="0" />
                <N VAR="phi" VALUE="0" />
            </REGION>
            <REGION REF="2">
                <!-- Sheath conditions - outflow at the sound speed -->
                <D VAR="ne" VALUE="Nnorm" />
                <D VAR="Ge" VALUE="vNorm*Nnorm*me" />
                <D VAR="Gd" VALUE="vNorm*Nnorm*md" />
                <N VAR="w" VALUE="0" />
                <N VAR="phi" VALUE="0" />
            </REGION>
        </BOUNDARYCONDITIONS>
        <!-- See lapd.md for note on BOUT++/H3 ICs-->
        <FUNCTION NAME="InitialConditions">
            <!-- Exponent arg is -x'^2 in H3 input file.
                 In our coord system x'^2 ~ (x^2 + y^2)/Rmax^2
             -->
            <E VAR="ne"  DOMAIN="0" VALUE="Nnorm*(1e-1 * exp(-(x*x + y*y)/Rmax/Rmax))" />
            <E VAR="Ge"  DOMAIN="0" VALUE="0" />
            <E VAR="Gd"  DOMAIN="0" VALUE="0" />
            <E VAR="w"   DOMAIN="0" VALUE="0" />
            <E VAR="phi" DOMAIN="0" VALUE="0" />
        </FUNCTION>

        <!-- Density source -->
        <FUNCTION NAME="dens_src">
            <!-- Exponent arg is -(x'/0.3)^2 in H3 input file.
                 In our coord system x'^2 ~ (x^2 + y^2)/Rmax^2
                 x' is already normalised from 0 to 1 - not sure why it's then divided by 0.3...
             -->
            <E VAR="ne" VALUE="5e21*exp(-(x*x + y*y)/Rmax/Rmax/0.3/0.3)" />
        </FUNCTION>
    </CONDITIONS>
</NEKTAR>
