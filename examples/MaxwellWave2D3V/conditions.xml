<?xml version="1.0" encoding="utf-8" ?>
<NEKTAR xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://www.nektar.info/schema/nektar.xsd">

    <EXPANSIONS>
        <E COMPOSITE="C[1]" NUMMODES="2" TYPE="MODIFIED" FIELDS="Ax,Ay,Az" />
        <E COMPOSITE="C[1]" NUMMODES="2" TYPE="MODIFIED" FIELDS="Bx,By,Bz" />
        <E COMPOSITE="C[1]" NUMMODES="2" TYPE="MODIFIED" FIELDS="Ex,Ey,Ez" />
        <E COMPOSITE="C[1]" NUMMODES="2" TYPE="MODIFIED" FIELDS="Jx,Jy,Jz" />
        <E COMPOSITE="C[1]" NUMMODES="2" TYPE="MODIFIED" FIELDS="Ax_minus,Ay_minus,Az_minus" />
        <E COMPOSITE="C[1]" NUMMODES="2" TYPE="MODIFIED" FIELDS="phi,phi_minus" />
        <E COMPOSITE="C[1]" NUMMODES="2" TYPE="MODIFIED" FIELDS="rho,rho_minus" />
    </EXPANSIONS>

    <CONDITIONS>

        <SOLVERINFO>
            <I PROPERTY="EQTYPE" VALUE="MaxwellWaveSystem" />
            <I PROPERTY="Projection" VALUE="Continuous" />
        </SOLVERINFO>

        <GLOBALSYSSOLNINFO>
            <V VAR="phi,Ax,Ay,Az,phi_minus,Ax_minus,Ay_minus,Az_minus">
            <I PROPERTY="GlobalSysSoln" VALUE="IterativeStaticCond" />
            <I PROPERTY="Preconditioner" VALUE="Diagonal"/>
            <I PROPERTY="IterativeSolverTolerance" VALUE="1e-8"/>
            </V>
        </GLOBALSYSSOLNINFO>

        <PARAMETERS>
            <P> Lambda = 0.0 </P>
            <P> epsilon = -1.0 </P>
            <!--- The TimeStep must be in dimensionless units -->
            <!--- The dimensionalisation of time is the length_scale / 2.99e8 -->
            <P> time_resolution_factor = 4 </P>
            <P> TimeStep = 2.0^(-10 - time_resolution_factor) </P>
            <!--- theta=0.5 for unconditionally stable implicit, 0.0 for fully explicit -->
            <P> theta = 0.0 </P>
            <P> particle_num_time_steps = 1024 * 2^time_resolution_factor</P>
            <P> particle_num_print_steps = 32 * 2^time_resolution_factor </P>
            <P> particle_num_write_field_energy_steps = 32 * 2^time_resolution_factor </P>
            <P> particle_num_write_field_steps = 32 * 2^time_resolution_factor </P>
            <P> particle_num_write_particle_steps = 32 * 2^time_resolution_factor </P>
            <P> grid_field_evaluations_step = 4 * 2^time_resolution_factor </P>
            <P> grid_field_evaluations_numx = 256 </P>
            <P> grid_field_evaluations_numy = 256 </P>

            <P> number_of_particle_species = 2 </P>
            <P> subtract_total_parallel_current_off_species = 0 </P>
            <P> num_particles_per_species = 100000 </P>
            <P> perform_deposition = 1 </P>
            <P> use_charge_conservation = 1 </P>

            <!--- Length scale - the length in metres of 1 dimensionless length unit -->
            <P> length_scale = 0.42234662961349806 </P>

            <!--- charge switch - binary -->
            <P> chargeswitch = 1 </P>

            <!--- Maxwellian (driftenergy=0) / beam (pitch > 0) / ring (driftenergy > 0)-->
            <P> particle_distribution_function_species_0 = 0 </P>
            <!--- Charge in units of elementary charge -->
            <P> charge_0 = -1 * chargeswitch </P>
            <!--- Charge in units of electron mass -->
            <P> mass_0 = 1 </P>
            <!--- Charge in units of eV -->
            <P> temperature_0 = 10000 </P>
            <!--- Drift in units of eV -->
            <P> driftenergy_0 = 0.0 </P>
            <!--- Pitch as normal, -1 <= pitch <= 1-->
            <P> pitch_0 = 0.0 </P>
            <!-- Number density in units of m^{-3} -->
            <P> number_density_0 = 1.0e20 </P>

            <P> mass_ratio = 1836.0 </P>

            <P> density_ratio = (1 - floor(number_of_particle_species / 3)) * 1 + floor(number_of_particle_species / 3) * 0.01 </P>

            <P> particle_distribution_function_species_1 = 0 </P>
            <P> charge_1 = 1 * chargeswitch </P>
            <P> mass_1 = 2 * mass_ratio </P>
            <P> temperature_1 = 10000 </P>
            <P> driftenergy_1 = 0.0 </P>
            <P> pitch_1 = 0.0 </P>
            <P> number_density_1 = number_density_0 * density_ratio </P>

            <P> particle_distribution_function_species_2 = 0 </P>
            <P> charge_2 = 2 * chargeswitch </P>
            <P> mass_2 = 4 * mass_ratio </P>
            <P> temperature_2 = 10000  </P>
            <P> driftenergy_2 = 3600000 </P>
            <P> pitch_2 = -0.55 </P>
            <P> number_density_2 = number_density_0 * (1 - density_ratio) / charge_2 </P>

            <P> B0x = 0.0 </P>
            <P> B0y = 0.0 </P>
            <P> B0z = 2.1 </P>

            <P> kx = 2.0 * PI  </P>
            <P> ky = 2.0 * PI  </P>
            <P> omega = sqrt(kx^2 + ky^2) </P>

        </PARAMETERS>

        <VARIABLES>
            <V ID="0"> Ax </V>
            <V ID="1"> Ay </V>
            <V ID="2"> Az </V>
            <V ID="3"> Bx </V>
            <V ID="4"> By </V>
            <V ID="5"> Bz </V>
            <V ID="6"> Ex </V>
            <V ID="7"> Ey </V>
            <V ID="8"> Ez </V>
            <V ID="9"> Jx </V>
            <V ID="10"> Jy </V>
            <V ID="11"> Jz </V>
            <V ID="12"> phi </V>
            <V ID="13"> rho </V>
            <V ID="14"> Ax_minus </V>
            <V ID="15"> Ay_minus </V>
            <V ID="16"> Az_minus </V>
            <V ID="17"> phi_minus </V>
            <V ID="18"> rho_minus </V>
        </VARIABLES>

        <FUNCTION NAME="InitialConditions">
            <E VAR="Bx" VALUE="0" />
            <E VAR="By" VALUE="0" />
            <E VAR="Bz" VALUE="0" />
            <E VAR="Ex" VALUE="0" />
            <E VAR="Ey" VALUE="0" />
            <E VAR="Ez" VALUE="0" />
            <E VAR="Jx" VALUE="0" />
            <E VAR="Jy" VALUE="0" />
            <E VAR="Jz" VALUE="0" />
            <E VAR="rho" VALUE="0" />
            <E VAR="rho_minus" VALUE="0" />
            <E VAR="phi" VALUE="0" />
            <E VAR="phi_minus" VALUE="0" />
            <E VAR="Ax" VALUE="0" />
            <E VAR="Ax_minus" VALUE="0" />
            <E VAR="Ay" VALUE="0" />
            <E VAR="Ay_minus" VALUE="0" />
            <E VAR="Az" VALUE="0" />
            <E VAR="Az_minus" VALUE="0" />
<!--- For testing purposes
            <E VAR="phi_minus" VALUE="sin(kx * x + ky * y - omega * (-TimeStep))" />
            <E VAR="phi" VALUE="sin(kx * x + ky * y)" />
            <E VAR="Ax_minus" VALUE="sin(kx * x + ky * y - omega * (-TimeStep))" />
            <E VAR="Ax" VALUE="sin(kx * x + ky * y)" />
            <E VAR="Ay_minus" VALUE="sin(kx * x + ky * y - omega * (-TimeStep))" />
            <E VAR="Ay" VALUE="sin(kx * x + ky * y)" />
            <E VAR="Az_minus" VALUE="sin(kx * x + ky * y - omega * (-TimeStep))" />
            <E VAR="Az" VALUE="sin(kx * x + ky * y)" />
 -->
        </FUNCTION>

        <BOUNDARYREGIONS>
            <B ID="1"> C[100] </B>
            <B ID="2"> C[200] </B>
            <B ID="3"> C[300] </B>
            <B ID="4"> C[400] </B>
        </BOUNDARYREGIONS>

        <BOUNDARYCONDITIONS>
            <REGION REF="1">
                <P VAR="Ax" VALUE="[3]" />
                <P VAR="Ay" VALUE="[3]" />
                <P VAR="Az" VALUE="[3]" />
                <P VAR="Bx" VALUE="[3]" />
                <P VAR="By" VALUE="[3]" />
                <P VAR="Bz" VALUE="[3]" />
                <P VAR="Ex" VALUE="[3]" />
                <P VAR="Ey" VALUE="[3]" />
                <P VAR="Ez" VALUE="[3]" />
                <P VAR="Jx" VALUE="[3]" />
                <P VAR="Jy" VALUE="[3]" />
                <P VAR="Jz" VALUE="[3]" />
                <P VAR="phi" VALUE="[3]" />
                <P VAR="rho" VALUE="[3]" />
                <P VAR="Ax_minus" VALUE="[3]" />
                <P VAR="Ay_minus" VALUE="[3]" />
                <P VAR="Az_minus" VALUE="[3]" />
                <P VAR="phi_minus" VALUE="[3]" />
                <P VAR="rho_minus" VALUE="[3]" />
            </REGION>
            <REGION REF="2">
                <P VAR="Ax" VALUE="[4]" />
                <P VAR="Ay" VALUE="[4]" />
                <P VAR="Az" VALUE="[4]" />
                <P VAR="Bx" VALUE="[4]" />
                <P VAR="By" VALUE="[4]" />
                <P VAR="Bz" VALUE="[4]" />
                <P VAR="Ex" VALUE="[4]" />
                <P VAR="Ey" VALUE="[4]" />
                <P VAR="Ez" VALUE="[4]" />
                <P VAR="Jx" VALUE="[4]" />
                <P VAR="Jy" VALUE="[4]" />
                <P VAR="Jz" VALUE="[4]" />
                <P VAR="phi" VALUE="[4]" />
                <P VAR="rho" VALUE="[4]" />
                <P VAR="Ax_minus" VALUE="[4]" />
                <P VAR="Ay_minus" VALUE="[4]" />
                <P VAR="Az_minus" VALUE="[4]" />
                <P VAR="phi_minus" VALUE="[4]" />
                <P VAR="rho_minus" VALUE="[4]" />
            </REGION>
            <REGION REF="3">
                <P VAR="Ax" VALUE="[1]" />
                <P VAR="Ay" VALUE="[1]" />
                <P VAR="Az" VALUE="[1]" />
                <P VAR="Bx" VALUE="[1]" />
                <P VAR="By" VALUE="[1]" />
                <P VAR="Bz" VALUE="[1]" />
                <P VAR="Ex" VALUE="[1]" />
                <P VAR="Ey" VALUE="[1]" />
                <P VAR="Ez" VALUE="[1]" />
                <P VAR="Jx" VALUE="[1]" />
                <P VAR="Jy" VALUE="[1]" />
                <P VAR="Jz" VALUE="[1]" />
                <P VAR="phi" VALUE="[1]" />
                <P VAR="rho" VALUE="[1]" />
                <P VAR="Ax_minus" VALUE="[1]" />
                <P VAR="Ay_minus" VALUE="[1]" />
                <P VAR="Az_minus" VALUE="[1]" />
                <P VAR="phi_minus" VALUE="[1]" />
                <P VAR="rho_minus" VALUE="[1]" />
            </REGION>
            <REGION REF="4">
                <P VAR="Ax" VALUE="[2]" />
                <P VAR="Ay" VALUE="[2]" />
                <P VAR="Az" VALUE="[2]" />
                <P VAR="Bx" VALUE="[2]" />
                <P VAR="By" VALUE="[2]" />
                <P VAR="Bz" VALUE="[2]" />
                <P VAR="Ex" VALUE="[2]" />
                <P VAR="Ey" VALUE="[2]" />
                <P VAR="Ez" VALUE="[2]" />
                <P VAR="Jx" VALUE="[2]" />
                <P VAR="Jy" VALUE="[2]" />
                <P VAR="Jz" VALUE="[2]" />
                <P VAR="phi" VALUE="[2]" />
                <P VAR="rho" VALUE="[2]" />
                <P VAR="Ax_minus" VALUE="[2]" />
                <P VAR="Ay_minus" VALUE="[2]" />
                <P VAR="Az_minus" VALUE="[2]" />
                <P VAR="phi_minus" VALUE="[2]" />
                <P VAR="rho_minus" VALUE="[2]" />
            </REGION>
        </BOUNDARYCONDITIONS>

    </CONDITIONS>

</NEKTAR>
